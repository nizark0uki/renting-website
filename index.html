<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <title>Document</title>
</head>
<body>
    <header>
        <img src="resources/cpu.png">
        <div class="hamburger">
            <i class="fas fa-bars"></i>
            <i class="fas fa-times"></i>
        </div>
        <ul>
            <li><a href="" class="active">Accueil</a></li>
            <li><a href="./annonces/annonces.html" class="hover">Annonces</a></li>
            <li><a href="./add listing form/add.html" class="hover"><i class="fa-solid fa-circle-plus" ></i> Publiez une annonce</a></li>
        </ul>
    </header>
    <section class="hero">
        <h1>Site n°1 de location pour étudiants en Tunisie</h1>
    </section>
    <section class="home">
        <div class="card">
            <h2>Pour Etudiants</h2>
            <p>
              Trouvez votre maison idéale
            </p>
            <button id="explore" >Explorer</button>
        </div>
        <div class="card">
            <h2>Pour Locateurs</h2>
            <p class=''>
              Ajoutez votre maison 
            </p>
            <button id="add" >Ajouter</button>
        </div>
    </section>
    <section class="derniers-annonces" id="listings">
        <h2>Derniers Annonces</h2>
        <div id="lastListing"></div>
    </section>
    
    <footer>
        <p>&copy; 2024 <a href="https://www.cpu-isimm.tn/" target="_blank">CPU</a>. All rights reserved.</p>
        <div class="socials">
            <a href="https://www.facebook.com/CPU.ISIMM/" target="_blank"><i class="fa-brands fa-facebook"></i></a>
            <a href="https://www.instagram.com/cpu.isimm/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://www.linkedin.com/in/cpu-isimm-068816218/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
        </div>

    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', fetchListings);

function fetchListings() {
    fetch('fetch_listings.php')
        .then(response => response.text())
        .then(data => {
            const lastListingDiv = document.getElementById('lastListing');
            lastListingDiv.innerHTML = data; // Insert the fetched listings

            // Attach event listeners to delete buttons
            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id; // Get the ID from the data attribute
                    deleteListing(id);
                });
            });
        })
        .catch(error => {
            console.error('Error fetching listings:', error);
        });
}

function deleteListing(id) {
    if (confirm('Are you sure you want to delete this listing?')) {
        fetch('delete_listing.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `id=${id}` // Send the ID as POST data
        })
        .then(response => response.text())
        .then(data => {
            console.log(data); // Log the response from the server
            fetchListings(); // Refresh the listings
        })
        .catch(error => {
            console.error('Error deleting listing:', error);
        });
    }
}


    </script>
</body>
</html>